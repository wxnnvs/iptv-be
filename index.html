<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic HLS Streams</title>
</head>
<body id="main">

<div id="video-container"></div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
<script>
async function loadAndParseM3U(url) {
    const response = await fetch(url);
    const text = await response.text();
    return text.split('\n').filter(line => line && !line.startsWith('#'));
}

function createVideoElement(streamUrl, index) {
    const videoContainer = document.getElementById('video-container');
    const videoElement = document.createElement('video');
    videoElement.id = 'video' + index;
    videoElement.controls = true;
    videoElement.width = 640;
    videoElement.height = 360;
    videoContainer.appendChild(videoElement);

    if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(streamUrl);
        hls.attachMedia(videoElement);
    } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
        videoElement.src = streamUrl;
    } else {
        console.error('HLS not supported');
    }
}

(async function() {
    const m3uUrl = 'https://iptv-org.github.io/iptv/countries/be.m3u';
    const streamUrls = await loadAndParseM3U(m3uUrl);
    
    streamUrls.forEach((streamUrl, index) => {
        createVideoElement(streamUrl, index);
    });
})();
</script>

</body>
</html>